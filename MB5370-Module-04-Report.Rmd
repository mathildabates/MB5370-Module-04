---
title: "MB5370-Module-04-Report"
author: "Mathilda Bates"
date: "2023-05-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# **MB5370 Module 04 - Data Science**

### Install & Load Packages
```{r}
install.packages("tidyverse")
library(tidyverse)
```

# WORKSHOP 1 - 2.0 Data Viz in R
Have a look at the default data provides by ggplot function.
```{r}
mpg     # car data
```

## 2.6 Create your first ggplot
### Map mpg data in a ggplot
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))
```
Function geom_point() adds a layer of points to your plot, which creates a scatterplot.

### Change point colour by class (ie. compact, SUV, etc.)
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, colour = class))
```

### Point size by class
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, size = class))
```
Warning message: using size for a discrete variable is not advised --> size indicates scale which is not apporiate for a discrete variable such as class.

### Point transparency by class (ie. alpha)
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, alpha = class))
```
Warning message: using alpha for a discrete variable is not advised --> similar to warning message above ^^

### Point shape by class
```{r}
gplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, shape = class))
```

### Set properties manually (ie. make all points blue)
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "blue")
```

### EXERCISE 1. 
What happens if you map an aesthetic to something other than a variable name? ie:
```{r}
 aes(colour = displ < 5)
```
Need to specify X and Y.

## 2.9 Facet and Panel Plots
Use 'facets' in ggplot to create subplots, and show a specific subset of bigger data.

### Use facet(wrap) to creat these subplots
** BUT only use facet(wrap) for discrete variables
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(~ class, nrow = 2)
```

### Use facet(grid) to compare multiple variables
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_grid(drv ~ cyl)
```

### Use a '.' if you don't want to facet in the rows and columns
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_grid(. ~ cyl)
```

### EXERCISE 2. 
What does nrow do? What does ncol do?
 --> 'nrow' and 'ncol' determine the # of rows and columns, respectively.

## 2.10 Fitting Simple Lines
### Display data as points
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))
```

### Display data as a smooth line
```{r}
ggplot(data = mpg) + 
  geom_smooth(mapping = aes(x = displ, y = hwy))
```

### Change line type based on drv value (ie. front wheel, rear wheel, or 4wd)
```{r}
ggplot(data = mpg) + 
  geom_smooth(mapping = aes(x = displ, y = hwy, linetype = drv))
```

### Set group aesthetic to categorical variable
```{r}
ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy, group = drv))
```

### Change colour of line based on drv value
```{r}
ggplot(data = mpg) +
  geom_smooth(
    mapping = aes(x = displ, y = hwy, color = drv),
    show.legend = FALSE,
  )
```

### Show legend
```{r}
ggplot(data = mpg) +
  geom_smooth(
    mapping = aes(x = displ, y = hwy, color = drv),
  )
```

### Try plotting multiple geoms on a single plot
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  geom_smooth(mapping = aes(x = displ, y = hwy))
```
Unable to simply change X variable in plot across all geoms --> need a global mapping to apply changes to EVERY geom() at the same time.

### Try plotting multiple geoms under a global mapping too ggplot() argument
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth()
```
Now I can change any variable once in the top line, and it will automatically change within all geoms throughout the rest of the argument.

### Use mappings in specific layers to enable the display of different aesthetics in different layers
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class)) + 
  geom_smooth()
```

### Specify different data for each layer
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class)) + 
  geom_smooth(data = filter(mpg, class == "subcompact"), se = FALSE)
```

### EXERCISE 3. 
1. What geom would you use to draw a line chart? A boxplot? A histogram? An area chart?
 --> I would use geom_abline() to draw a line chart. I would use geom_boxplot() for a boxplot. I would use geom_histogram() for a histogram. I would use geom_area() for an area chart/plot.

2. Run this code in your head and predict what the output will look like. Then, run the code in R and check your predictions.
 --> I predict that these two plots will look exactly the same. The top one uses the global mapping, while the bottom one specifies individual mapping per geom.
#### PLOT 1:
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth()
```
#### PLOT 2:
```{r}
ggplot() + 
  geom_point(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_smooth(data = mpg, mapping = aes(x = displ, y = hwy))
```
My predictions were correct.

3. Will these two graphs look different? Why/why not?
 --> These two graphs don't look different as they display the same thing, just in different expressions of code.

## 2.11 Transformations and Stats
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut))
```
Diamonds have a higher count with high quality cuts over low quality cuts.

### Use geoms and stats interchangeably
```{r}
ggplot(data = diamonds) + 
  stat_count(mapping = aes(x = cut))
```
Produces the same plot --> every geom has a default stat and every stat has a default geom.

### Override a default stat
--> change default stat to 'identity'
```{r}
demo <- tribble(
  ~cut,         ~freq,
  "Fair",       1610,
  "Good",       4906,
  "Very Good",  12082,
  "Premium",    13791,
  "Ideal",      21551
)
demo
ggplot(data = demo) +
  geom_bar(mapping = aes(x = cut, y = freq), stat = "identity")
```

### OR override a default mapping from transformed variables to aesthetics
--> display a bar chart of proportion of your total diamond dataset rather than a count
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = stat(prop), group = 1))
```

### Use stat_summary() to show a little more about these transformations in your plot (good practice in transparency)
```{r}
ggplot(data = diamonds) + 
  stat_summary(mapping = aes(x = cut, y = depth),
    fun.min = min,
    fun.max = max,
    fun = median
  )
```

### What is the problem with these 2 graphs?
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = after_stat(prop)))
```
There's no colour to distinguish any details. Data is not being displayed accurately.
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = color, y = after_stat(prop)))
```
Colour is now displayed but there is no scale or magnitude of values. Data is therefore still not being displayed accruately.

## 2.12 Position Adjustments
### Change aspects of bar colours with fill and colour
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, colour = cut))
```
Creates colourred halo around bars.
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = cut))
```
Fills entire bar with colour.

### Use a different variable (ie. clarity)
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity))
```

### Position Adjustments allow you to customise your plots in 3 ways: 
'identity' (raw data), 'fill' (changes heights) and 'dodge' (which forces ggplot2 to not put things on top of each other)

### Position = 'identity'
Place each object exactly where it falls in the context of the graph. Good for point charts like scatter plots! For other graphs like barplots, need to ALTER the bar aesthetic. ie.
#### By altering transparency (alpha)
```{r}
ggplot(data = diamonds, mapping = aes(x = cut, fill = clarity)) + 
  geom_bar(alpha = 1/5, position = "identity")
```

#### By colouring the bar outlines with no fill colour
```{r}
ggplot(data = diamonds, mapping = aes(x = cut, colour = clarity)) + 
  geom_bar(fill = NA, position = "identity")
```

### Position = 'fill'
Works like stacking, but makes each set of stacked bars the same height.
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "fill")
```

### Position = 'dodge'
Places overlapping objects directly beside one another.
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "dodge") 
```
Similar plot layout to Nick's example for the Plot Deconstruction homework.

### BONUS Position = 'jitter'
Slightly moves points so you can see them all (especially when they overlap). Adds a small amount of random noise to each point to avoid overplotting when points overlap. This is useful for scatterplots but not barplots.
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), position = "jitter")
```


# WORKSHOP 2 - 3.0 Using a ggplot2 for communication
Make plots go from ok to great with added elements of communication!

## 3.1 Labels
### Start with adding a title --> labs()
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  labs(title = "Fuel efficiency generally decreases with engine size")
```

### Add a Subtitle and a Caption
Subtitle helps to add additional detail in a smaller font beneath the title. Caption helps to add text at the bottom right of the plot, often used to describe the source of the data.
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  labs(
    title = "Fuel efficiency generally decreases with engine size",
    subtitle = "Two seaters (sports cars) are an exception because of their light weight",
    caption = "Data from fueleconomy.gov"
  )
```

### Replace legend titles and axis labels too
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  geom_smooth(se = FALSE) +
  labs(
    x = "Engine displacement (L)",
    y = "Highway fuel economy (mpg)",
    colour = "Car type"
  )
```

## 3.2 Annotations 
### Add text to the plot itself
```{r}
best_in_class <- mpg %>%
  group_by(class) %>%
  filter(row_number(desc(hwy)) == 1)

ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  geom_text(aes(label = model), data = best_in_class)
```
Can fix overlapping labels with the nudge() function in the future.

## 3.3 Scales
### ggplot2 will automatically add scales
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class))
```

### Can change this default by offering values to the scale parameters
Try adding numbers in the appropriate scale arguments.
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  scale_x_continuous() +
  scale_y_continuous() +
  scale_colour_discrete()
```

## 3.4 Axis Ticks
### Can use labels as an argument to change the text label associated with ticks
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  scale_y_continuous(breaks = seq(15, 40, by = 5))
```

### OR use labels set to NULL to suppress the labels altogether
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  scale_x_continuous(labels = NULL) +
  scale_y_continuous(labels = NULL)
```

## 3.5 Legends and Colour Schemes
### Change the position of a legend using theme() function
```{r}
base <- ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class))
base + theme(legend.position = "left")
base + theme(legend.position = "top")
base + theme(legend.position = "bottom")
base + theme(legend.position = "right") # the default --> I prefer this one
```

### Suppress display of the legend all together
```{r}
base + theme(legend.position = "none")
```

## 3.6 Replacing a scale
Continuous position scales vs colour scales.
### Plot transformations of your variable
ie. log transform to adjust for scale
```{r}
ggplot(diamonds, aes(carat, price)) +
  geom_bin2d() + 
  scale_x_log10() + 
  scale_y_log10()
```

### Customise a colour scale
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = drv))

ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = drv)) +
  scale_colour_brewer(palette = "Set1")
```
Second plot makes colours more distinct.

### Add redundant shape mapping to account for plot being displayed in black & white
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = drv, shape = drv)) +
  scale_colour_brewer(palette = "Set1")
```
Can use colour brewer scales to create personalised colours @ http://colorbrewer2.org/

### Use predefined colours 
```{r}
presidential %>%
  mutate(id = 33 + row_number()) %>%
  ggplot(aes(start, id, colour = party)) +
    geom_point() +
    geom_segment(aes(xend = end, yend = id)) +
    scale_colour_manual(values = c(Republican = "red", Democratic = "blue"))
```

### Try Viridis colour scheme
```{r}
install.packages('viridis')
install.packages('hexbin')
library(viridis)
library(hexbin)

df <- tibble( # note we're just making a fake dataset so we can plot it
  x = rnorm(10000),
  y = rnorm(10000)
)
ggplot(df, aes(x, y)) +
  geom_hex() + # a new geom! --> hexagonal points
  coord_fixed()

ggplot(df, aes(x, y)) +
  geom_hex() +
  viridis::scale_fill_viridis() +
  coord_fixed()
```

## 3.7 Themes
Customise theme of entire plot --> ggplot2 has 8 default themes.
### Black and white
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  theme_bw()
```
Highlights border of graph in black.

### Light
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  theme_light()
```
Makes border lighter.

### Classic
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  theme_classic()
```
Removes backdrop of plot.

### Dark
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  theme_dark()
```
Makes backdrop dark.

### Set all of my arguments to my own curated theme
```{r}
theme (panel.border = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        legend.position="right",
        legend.title=element_blank(),
        legend.text=element_text(size=8),
        panel.grid.major = element_blank(),
        legend.key = element_blank(),
        legend.background = element_blank(),
        axis.text.y=element_text(colour="black"),
        axis.text.x=element_text(colour="black"),
        text=element_text(family="Calibri")) 
```

## 3.8 Saving and exporting your plots
Using ggsave().
```{r}
# ggplot(mpg, aes(displ, hwy)) + geom_point() # commented out so knitr will run

# ggsave("my-plot.pdf")
```
Saves 7 x 4.32 in image. Use the width and height arguments to change the dimensions of plot. I will not do this as I have used an RMarkdown to export all my ggplots.


# WORKSHOP 3 - 4.0 Reproducible work
## Install GitHub
```{r}
install.packages("usethis")
library(usethis)
use_git_config(user.name = "mathildabates", user.email = "mathildabates@gmail.com")
```

